# Исправление проблемы с рассрочкой

## Проблема
При создании или редактировании предложения страховщика через пользовательский интерфейс, когда галочка "рассрочка доступна" не отмечена, система выдавала ошибку: "Ошибки в форме: Количество платежей в год: Обязательное поле."

## Причина
Поле `payments_per_year` было обязательным в форме, но логика автоматической установки значения в 1 (при отсутствии рассрочки) выполнялась в методе `clean()` формы, который вызывается после валидации отдельных полей.

## Решение
1. **Переопределили поле `payments_per_year`** в обеих формах (`OfferForm` и `AddOfferToSummaryForm`) как `IntegerField` с `required=False`
2. **Изменили логику валидации** в методе `clean_payments_per_year()`:
   - Если рассрочка недоступна (`installment_available=False`), автоматически возвращаем 1
   - Если рассрочка доступна, проверяем валидность значения
   - Если значение не указано, устанавливаем по умолчанию 1

## Изменения в коде

### summaries/forms.py
- Добавлено переопределение поля `payments_per_year` в `OfferForm` и `AddOfferToSummaryForm`
- Изменена логика валидации в методе `clean_payments_per_year()`
- Упрощена логика в методе `clean()` (убрана дублирующаяся обработка рассрочки)

## Тестирование
Созданы комплексные тесты:
- `summaries/test_installment_fix.py` - модульные тесты форм
- `summaries/test_installment_integration.py` - интеграционные тесты через веб-интерфейс
- Обновлены существующие тесты в `summaries/tests_functional.py`

## Результат
Теперь при создании/редактировании предложения:
- ✅ Если рассрочка недоступна - поле `payments_per_year` автоматически устанавливается в 1
- ✅ Если рассрочка доступна - валидируется корректность значения
- ✅ Нет ошибок валидации при снятой галочке "рассрочка доступна"
- ✅ Сохраняется обратная совместимость с существующим функционалом

## Проверка
Все тесты проходят успешно:
- Модульные тесты: ✅ 7/7
- Интеграционные тесты: ✅ 4/4  
- Функциональные тесты форм: ✅ 6/6