# HTTP-only configuration for ACME challenge during certificate generation
server {
    listen 80;
    server_name insflow.ru zs.insflow.ru insflow.tw1.su zs.insflow.tw1.su 80.90.189.37;
    
    # ACME challenge location for Let's Encrypt - MUST be accessible via HTTP
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
        try_files $uri =404;
        
        # Ensure no redirects to HTTPS
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
        
        # Allow access from anywhere
        allow all;
    }
    
    # For all other requests, serve a simple response (no redirects!)
    location / {
        return 200 "Certificate generation in progress. ACME challenge is available at /.well-known/acme-challenge/";
        add_header Content-Type text/plain;
        
        # Ensure no HTTPS redirects during certificate generation
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}