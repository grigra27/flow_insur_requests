# Static File Optimization Configuration
# This file contains optimized settings for serving static files over HTTPS

# Enable gzip compression for static files
gzip_static on;
gzip_vary on;

# Brotli compression (if available)
# brotli_static on;

# Default caching for static files
expires 30d;
add_header Cache-Control "public, max-age=2592000";
add_header Vary "Accept-Encoding";

# CSS files - long-term caching with proper MIME type
location ~* \.(css)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Content-Type "text/css; charset=utf-8";
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    
    # Security headers for CSS
    add_header X-Content-Type-Options "nosniff" always;
}

# JavaScript files - long-term caching with proper MIME type
location ~* \.(js)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Content-Type "application/javascript; charset=utf-8";
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    
    # Security headers for JS
    add_header X-Content-Type-Options "nosniff" always;
}

# Image files - long-term caching with optimization
location ~* \.(png|jpg|jpeg|gif|ico|svg|webp|avif)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    
    # Image-specific optimizations
    add_header Accept-Ranges "bytes";
    
    # Security headers for images
    add_header X-Content-Type-Options "nosniff" always;
}

# Font files - long-term caching with CORS support
location ~* \.(woff|woff2|ttf|eot|otf)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, Accept, Content-Type";
    
    # Font-specific optimizations
    add_header Vary "Accept-Encoding";
    
    # Security headers for fonts
    add_header X-Content-Type-Options "nosniff" always;
}

# HTML files - shorter caching for dynamic content
location ~* \.(html|htm)$ {
    expires 1h;
    add_header Cache-Control "public, max-age=3600, must-revalidate";
    add_header Vary "Accept-Encoding";
    
    # Security headers for HTML
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
}

# JSON and XML files - moderate caching
location ~* \.(json|xml)$ {
    expires 1d;
    add_header Cache-Control "public, max-age=86400";
    add_header Vary "Accept-Encoding";
    add_header Content-Type "application/json; charset=utf-8";
    
    # Security headers
    add_header X-Content-Type-Options "nosniff" always;
}

# Manifest and service worker files - short caching
location ~* \.(manifest|webmanifest)$ {
    expires 1h;
    add_header Cache-Control "public, max-age=3600";
    add_header Content-Type "application/manifest+json; charset=utf-8";
}

# Source map files - no caching in production
location ~* \.(map)$ {
    expires -1;
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    
    # Hide source maps in production
    return 404;
}